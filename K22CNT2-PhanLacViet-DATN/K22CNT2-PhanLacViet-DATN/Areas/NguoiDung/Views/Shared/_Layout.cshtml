@{
    var userLogin = Context.Session.GetString("USER_LOGIN");
}


<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Đọc Truyện Chữ</title>
    <script>
        (function() {
            try {
                var theme = localStorage.getItem('theme');
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
            } catch (e) {
                console && console.warn && console.warn('Theme init failed', e);
            }
        })();
    </script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/NguoiDung/css/header.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <header class="header-main">
        <div class="header-left">
            <a asp-area="NguoiDung" asp-controller="Truyen" asp-action="Index" class="header-logo">
                <div class="logo logo-2">VBOOK<span>.NET</span></div>
            </a>

            <nav class="main-nav">
                <div class="nav-item dropdown">
                    <span class="nav-link">Thể loại <i class="fa-solid fa-chevron-down"></i></span>
                    <div class="dropdown-menu mega-menu">
                        <div class="mega-menu-grid">
                            <a href="@Url.Action("Search", "Truyen", new { genres = 1 })">Huyền Huyễn</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 2 })">Tiên Hiệp</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 3 })">Ngôn Tình</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 4 })">Đô Thị</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 5 })">Khoa Huyễn</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 6 })">Kiếm Hiệp</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 7 })">Xuyên Không</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 8 })">Trọng Sinh</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 9 })">Kinh Dị</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 10 })">Hài Hước</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 11 })">Phiêu Lưu</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 12 })">Võ Thuật</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 13 })">Tu Tiên</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 14 })">Học Đường</a>
                            <a href="@Url.Action("Search", "Truyen", new { genres = 15 })">Tâm Lý</a>
                        </div>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <span class="nav-link">Xếp hạng <i class="fa-solid fa-chevron-down"></i></span>
                    <div class="dropdown-menu">
                        <a href="/XepHang/XemNhieu">Xem nhiều nhất</a>
                        <a href="/XepHang/MoiCapNhat">Mới cập nhật</a>
                        <a href="/XepHang/HoanThanh">Đã hoàn thành</a>
                    </div>
                </div>
            </nav>
        </div>

        <div class="header-search">
            <form asp-area="NguoiDung" asp-controller="Truyen" asp-action="Search" method="get" class="search-container">
                <button type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
                <input type="text" id="searchInput" name="keyword" placeholder="Tìm truyện, tác giả..." autocomplete="off" />
                <div id="searchResults" class="search-results-dropdown"></div>
            </form>
        </div>

        <div class="header-right">
            <button id="theme-toggle" class="icon-btn" title="Chế độ Sáng/Tối">
                <i class="fa-regular fa-moon"></i>
            </button>

            @if (string.IsNullOrEmpty(userLogin))
            {
                <div class="header-auth">
                    <a asp-action="Auth" asp-route-mode="login" class="btn-text">Đăng nhập</a>
                    <a asp-action="Auth" asp-route-mode="register" class="btn-primary-custom">Đăng ký</a>
                </div>
            }
            else
            {
                <div class="header-user-area">
                    <button class="icon-btn notification-btn" id="ntfBellBtn" data-user="@userLogin">
                        <i class="fa-regular fa-bell"></i>
                        <span class="ntf-badge" id="ntfBadge" style="display:none">0</span>
                    </button>

                    <div class="ntf-dropdown" id="ntfDropdown">
                        <div class="ntf-header">
                            <span>Thông báo mới</span>
                            <span class="ntf-mark-all" onclick="markAllRead()">Đọc tất cả</span>
                        </div>
                        <div class="ntf-list" id="ntfList">
                            <div class="ntf-empty">Đang tải...</div>
                        </div>
                        <a href="@Url.Action("ThongBao", "NguoiDung", new { area = "NguoiDung" })" class="ntf-footer">
                            Xem tất cả thông báo
                        </a>
                    </div>

                    <div class="user-profile-wrapper">
                        <div class="user-avatar-circle">
                            <img src="/NguoiDung/images/Avatar/default.jpg"
                                 id="userHeaderAvatar"
                                 alt="Avatar"
                                 class="avatar-img"
                                 onerror="this.src='/NguoiDung/images/Avatar/default.jpg';" />
                        </div>

                        <div class="user-dropdown-menu">
                            <div class="user-info">
                                <strong>@userLogin</strong>
                                <span>Thành viên</span>
                            </div>
                            <hr />
                            <a asp-area="NguoiDung" asp-controller="NguoiDung" asp-action="ThongTinNguoiDung">
                                <i class="fa-solid fa-user"></i> Thông tin
                            </a>

                            <a asp-area="NguoiDung" asp-controller="NguoiDung" asp-action="ThongTinTacGia">
                                <i class="fa-solid fa-book-open-reader"></i> Truyện đã đăng
                            </a>

                            <a asp-area="NguoiDung" asp-controller="NguoiDung" asp-action="DangTruyen">
                                <i class="fa-solid fa-pen-to-square"></i> Đăng truyện
                            </a>
                            <hr />
                            <a asp-area ="NguoiDung" asp-controller="Truyen" asp-action="Logout" class="logout-link"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </header>
    <main class="container mt-4">
        @RenderBody()
    </main>
    <footer class="border-top text-muted mt-5">
        <div class="container py-3">
            &copy; 2025 - Đồ án tốt nghiệp | Phan Lạc Việt
        </div>
    </footer>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/NguoiDung/js/header.js" asp-append-version="true"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>
